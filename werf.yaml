project: prozorro-api
configVersion: 1
---
image: ~
from: python:3.8-slim
docker:
  WORKDIR: /app
  EXPOSE: "80"
  ENV:
    PYTHONPATH: "/app/src/:${PYTHONPATH}"
    TZ: Europe/Kiev
    LANG: en_US.UTF-8
    LC_ALL: en_US.UTF-8
    LC_LANG: en_US.UTF-8
    PYTHONIOENCODING: UTF-8
  CMD: ["gunicorn", "--bind", "0.0.0.0:80", "-k", "gevent", "--paste", "etc/service.ini", "--graceful-timeout=60"]
git:
- add: /
  to: /app
  stageDependencies:
    install:
      - "requirements.txt"
    setup:
      - '**/*'
shell:
  beforeInstall:
  - apt-get update
  - apt-get install -y git gcc libssl-dev
  - pip install --upgrade pip setuptools wheel
  install:
  - pip install --no-cache-dir -r /app/requirements.txt
  setup:
  - pip install -e /app
mount:
- from: tmp_dir
  to: /var/lib/apt/lists
- from: build_dir
  to: /var/cache/apt
